<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>后台管理</title>
<link href="__PUBLIC__/admin/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/admin/js/alert-tip.js"></script>
<style type="text/css">
	.yaheifont{font-family:"Microsoft YaHei","黑体","宋体";}
	.returnUpBtn{font-size:16px;background:none;color:#aaa;border:1px solid #ccc;border-radius:3px;}
	
	#selectLi li{clear:none ! important;}
	.radioDiv label{cursor:pointer;}
	.radioDiv label input{vertical-align:middle;}
	.upload_btn{font-family:"Microsoft YaHei","黑体","宋体";width:80px;height:25px;
		font-weight:normal;font-size:14px;}
	
	.xuhao_div{width:30px;height:30px;line-height:30px;text-align:center;font-size:14px;
		color:#fff;background:url(./Public/admin/images/index_bg.png);}
	.step_textarea{font-family:"Microsoft YaHei","黑体","宋体";height:100px;width:450px;}
</style>
</head>
<body>
<div class="formbody">
	<div id="usual1" class="usual">
		<div class="itab">
			<ul>
				<li><a href="#tab1" class="selected">分类<{:$vo['id'] ? '修改' : '新增'}></a></li>
			</ul>
		</div>
		<form method="post" action="<{:U('add')}>" enctype="multipart/form-data" id="memberform">
		<input type="hidden" name='info[id]' value="<{$vo['id']|default=''}>"/>
		<input type="hidden" name='lastURL' value="<{$lastURL}>"/>
		<div id="tab1" class="tabson">
			<ul class="forminfo">
				<li>
					<label>标题<b>*</b></label>
					<input type="text" name="info[title]" value="<{$vo['title']}>" class="dfinput yaheifont">
				</li>
				<li>
					<label>教程分类<b>*</b></label>
					<select name="info[sortid]" class="dfinput yaheifont">
						<foreach name="sortArr" item="v">
							<option value="<{$v['id']}>" <if condition="$v['id'] eq $vo['sortid']">selected</if> ><{$v['name']}></option>
						</foreach>
					</select>
				</li>
				<li id="selectLi">
					<label>标签<b></b></label>
					<select data-placeholder='选择标签' class='chosen-select' multiple style='width:350px;' tabindex='4' name="tag[]">
						<option value=''></option>
						<foreach name='tagArr' item='tv'>
							<option value="<{$tv['id']}>" <{:in_array($tv['id'],$tagStrArr) ? 'selected' : ''}> ><{$tv['name']}></option>
						</foreach>
					</select>
				</li>
				<li>
					<label>发布时间<b></b></label>
					<input type="text" id="start_time" onclick="return showCalendar('start_time','y-mm-dd');" name="info[fabu_time]" value="<{$vo['fabu_time']}>" class="dfinput yaheifont">
				</li>
				<li>
					<label>教程封面<b></b></label>
					<input type="file" name="pic" class="yaheifont" onchange="$('.picShow').hide();">
					<span style='color:red;display:inline'>注：请上传尺寸为400px*400px的图片</span>
				</li>
				<notempty name="vo.pic">
				<li class="picShow">
					<label>&nbsp;<b></b></label>
					<span style=''><img src="<{$vo['pic']}>" style="width:150px;" /></span>
				</li>
				</notempty>
				<li>
					<label>教程简介<b></b></label>
					<textarea class="dfinput yaheifont" name="info[introduce]" style="height:150px;width:450px;"><{$vo['introduce']}></textarea>
				</li>
				<li>
					<label>发布类型<b></b></label>
					<div class="radioDiv">
						<label data-type="1"><input type="radio" name="info[type]" checked value="1" /> 内容</label>
						<label data-type="2"><input type="radio" name="info[type]" value="2" /> 视频</label>
						<label data-type="3"><input type="radio" name="info[type]" value="3" /> 链接</label>
					</div>
				</li>
				
				<span id="linkSpan" style="display:none;">
				<li>
					<label>视频地址<b></b></label>
					<input type="text" name="info[link]" value="<{$vo['link']}>" class="dfinput yaheifont">
				</li>
				</span>
				
				<span id="contentSpan">
				<li>
					<label>方法/步骤<b></b></label>
				</li>
				
				<span>
				<li>
					<label><div class="xuhao_div">1</div></label>
					<textarea class="dfinput step_textarea" name="info[introduce]"><{$vo['introduce']}></textarea>
				</li>
				<li>
					<label>教程封面</label>
					<input type="button" class="btn upload_btn" value="上传图片" onclick="imgBtnClick('1');"/>
					<input type="hidden" name="pic1" class="pic_input" id="pic_input1" />
				</li>
				<li class="picShow">
					<label>&nbsp;</label>
					<img src="" class="pic_img" id="pic_img1" style="width:150px;display:none;" />
				</li>
				<li style="height:10px;"></li>
				</span>
				
				<span>
				<li>
					<label><div class="xuhao_div">2</div></label>
					<textarea class="dfinput step_textarea" name="info[introduce]"><{$vo['introduce']}></textarea>
				</li>
				<li>
					<label>教程封面</label>
					<input type="button" class="btn upload_btn" value="上传图片" onclick="imgBtnClick('2');"/>
					<input type="hidden" name="pic2" class="pic_input" id="pic_input1" />
				</li>
				<li class="picShow">
					<label>&nbsp;</label>
					<img src="" class="pic_img" id="pic_img2" style="width:150px;display:none;" />
				</li>
				<li style="height:10px;"></li>
				</span>
				
				<span>
				<li>
					<label><div class="xuhao_div">3</div></label>
					<textarea class="dfinput step_textarea" name="info[introduce]"><{$vo['introduce']}></textarea>
				</li>
				<li>
					<label>教程封面</label>
					<input type="button" class="btn upload_btn" value="上传图片" onclick="imgBtnClick('3');"/>
					<input type="hidden" name="pic3" class="pic_input" id="pic_input3" />
				</li>
				<li class="picShow">
					<label>&nbsp;</label>
					<img src="" class="pic_img" id="pic_img3" style="width:150px;display:none;" />
				</li>
				<li style="height:10px;"></li>
				</span>
				
				</span>
				
				<li>
					<label>&nbsp;</label>
					<input type="button" class="btn yaheifont" style="font-size:16px;" value="保&nbsp;&nbsp;&nbsp;存" onclick="save();return false"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="button" class="btn yaheifont returnUpBtn" value="返&nbsp;&nbsp;&nbsp;回" onclick="window.history.go(-1);"/>
				</li>
			</ul>
		</div>
		</form>
	</div>
</div>
<!-- 图片上传DIV开始 -->
<div style="visibility:hidden;">
<iframe name='img_frame' id="img_frame" style="visibility:hidden;height:10px"></iframe>
<form name="img_form" action="<{:U('upload')}>" encType="multipart/form-data" method="post" target="img_frame">
	<input type="file" name="imgfile" id="img_file" onchange="document.img_form.submit()"/>
</form>
</div>
<!-- 图片上传DIV结束 -->
</body>
<!--多选下拉框开始-->
<link rel="stylesheet" href="__PUBLIC__/chosen/chosen.min.css" type='text/css' />
<script src="__PUBLIC__/chosen/chosen.jquery.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/chosen/prism.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
var config = {
	'.chosen-select'           : {},
	'.chosen-select-deselect'  : {allow_single_deselect:true},
	'.chosen-select-no-single' : {disable_search_threshold:10},
	'.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
	'.chosen-select-width'     : {width:"95%"}
}
for (var selector in config) {
	$(selector).chosen(config[selector]);
}
</script>
<!--多选下拉框结束-->
<!-- 日期插件开始 -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/calendar/calendar.css" />
<script type='text/javascript' src='__PUBLIC__/calendar/calendar.js'></script>
<!-- 日期插件结束 -->
<script type="text/javascript">
function save(obj){
	if($("input[name='info[name]']").val()==''){
		alert_tip('填写名称');
		return;
	}
	$('#memberform').submit();
}
$(function(){
	//课程类别选择
	$(".radioDiv label").click(function(){
		$('#linkSpan').hide();
		$('#contentSpan').hide();
		var typenum=$(this).attr('data-type');
		if(typenum=='1'){
			$('#contentSpan').show();
		}else if(typenum=='2'){
			$('#linkSpan').show();
			$('#linkSpan label').text('视频地址');
		}else if(typenum=='3'){
			$('#linkSpan').show();
			$('#linkSpan label').text('链接地址');
		}
	});
	//上传图片回调
	$('#img_frame').load(function(){
        try{
			var htmlRes = $(this).contents().find('body').html();
    	}catch(e){
			var htmlRes = window.frames["img_frame"].document.body.innerText;
		}
		htmlRes = jQuery.trim(htmlRes);
		if(htmlRes){
			$(".pic_input_active").val(htmlRes);
			$(".pic_img_active").attr('src',htmlRes).show();
		}else{
			alert_tip('上传图片失败');
		}
    });
})
//开始上传图片
function imgBtnClick(num){
	$(".pic_input").removeClass("pic_input_active")
	$(".pic_img").removeClass("pic_img_active")
	$("#pic_input"+num).addClass("pic_input_active")
	$("#pic_img"+num).addClass("pic_img_active")
	$('#img_file').click();
}
</script>
</html>